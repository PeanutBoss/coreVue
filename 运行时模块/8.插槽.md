### 插槽

```
export function initSlots (instance, children) {
    const { vNode } = instance
    if (vNode.shapeFlag & ShapeFlags.SLOT_CHILDREN) {
        normalizeObjectSlot(children, instance.slots)
    }
}

function normalizeObjectSlot(children, slots) {
    for (const key in children) {
        const value = children[key]
        // normalizeSlotValue 接受的是结果，但此时value是函数，且需要传入props
        slots[key] = props => normalizeSlotValue(value(props))
    }
}

function normalizeSlotValue (value) {
    return Array.isArray(value) ? value : [value]
}
插槽
```

```typescript
import { createVNode } from "../vNode";

export function renderSlots (slots, name) {
    const slot = slots[name] || slots
    if (slot) {
        return createVNode('div', {}, slot)
    }
}
```

```typescript
export function createComponentInstance (vNode) {
  const component: any = {
    vNode,
    type: vNode.type,
    setupState: {},
    props: {},
    slots: {},
    emit: () => {}
  }
  component.emit = emit.bind(null, component)
  return component
}

export function setupComponent (instance) {
  // TODO
  initProps(instance, instance.vNode.props)
  initSlots(instance, instance.vNode.children)

  setupStatefulComponent(instance)
}
```

```typescript
const publicPropertiesMap = {
    $el: i => i.vNode.el,
    $slots: i => i.slots
}

export const PublicInstanceProxyHandlers = {
    get({_: instance}, key) {
      const { setupState, props } = instance
      if (hasOwn(setupState, key)) {
        return setupState[key]
      } else if (hasOwn(props, key)) {
        return props[key]
      }
      const publicGetter = publicPropertiesMap[key]
      if (publicGetter) {
        return publicGetter(instance)
      }
    }
}
```

##### 作用域插槽

```typescript
export function renderSlots (slots, name, props) {
    const slot = slots[name]
    if (slot) {
        if (typeof slot === "function") {
            return createVNode('div', {}, slot(props))
        }
    }
}
```

```typescript
export function createVNode (type, props?, children?) {
  const vNode = {
    type,
    props,
    children,
    shapeFlag: getShapeFlag(type),
    el: null
  }
  if (typeof children === 'string') {
    vNode.shapeFlag |= ShapeFlags.TEXT_CHILDREN
  } else if (Array.isArray(children)) {
    vNode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN
  }
  // slot - 组件&object
  if (vNode.shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {
    if (typeof children === 'object') {
      vNode.shapeFlag |= ShapeFlags.SLOT_CHILDREN
    }
  }
  return vNode
}
```

```typescript
export function initSlots (instance, children) {
    const { vNode } = instance
    if (vNode.shapeFlag & ShapeFlags.SLOT_CHILDREN) {
        normalizeObjectSlot(children, instance.slots)
    }
}

function normalizeObjectSlot(children, slots) {
    for (const key in children) {
        const value = children[key]
        // normalizeSlotValue 接受的是结果，但此时value是函数，且需要传入props
        slots[key] = props => normalizeSlotValue(value(props))
    }
}
```